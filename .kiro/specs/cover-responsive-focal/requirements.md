# 要件定義書

## はじめに

Cover Responsive Focalは、WordPressのGutenbergエディタにおける標準のカバーブロックを拡張し、ブレークポイント別にフォーカルポイントを設定できる機能を提供するプラグインです。これにより、デスクトップ、タブレット、モバイルの各デバイスで、背景画像の重要な部分を適切に表示できるようになります。

## 要件

### 要件1

**ユーザーストーリー:** WordPressサイト管理者として、カバーブロックの背景画像をモバイルとタブレットで最適な位置で表示したいので、デバイス別にフォーカルポイントを設定できる機能が欲しい

#### 受け入れ基準

1. WHEN カバーブロックを選択した時 THEN インスペクターサイドバーにレスポンシブフォーカルポイント設定UIが表示される SHALL
2. WHEN モバイル用フォーカルポイントを有効にした時 THEN モバイル用フォーカルポイントピッカーが表示される SHALL
3. WHEN タブレット用フォーカルポイントを有効にした時 THEN タブレット用フォーカルポイントピッカーが表示される SHALL
4. WHEN フォーカルポイントを設定した時 THEN x座標とy座標が0-1の範囲で保存される SHALL
5. WHEN デフォルト状態の時 THEN responsiveFocal配列は空の状態で、標準のカバーブロック動作に準拠する SHALL

### 要件2

**ユーザーストーリー:** WordPressサイト訪問者として、どのデバイスからアクセスしても背景画像の重要な部分が見えるように、デバイス別に最適化された表示を受けたい

#### 受け入れ基準

1. WHEN ページが読み込まれた時 THEN モバイル（600px以下）とタブレット（601px-782px）に対応するCSSメディアクエリが動的に生成される SHALL
2. WHEN 画面サイズが変更された時 THEN 対応するフォーカルポイントが自動的に適用される SHALL
3. WHEN responsiveFocal配列が空の時 THEN 標準のfocalPoint属性の動作に完全にフォールバックする SHALL
4. WHEN デスクトップ（783px以上）でアクセスした時 THEN 標準のfocalPoint属性が適用される SHALL

### 要件3

**ユーザーストーリー:** WordPressサイト管理者として、既存のカバーブロックとの互換性を保ちたいので、プラグインを有効化しても既存のブロックが正常に動作する必要がある

#### 受け入れ基準

1. WHEN responsiveFocal配列が空の時 THEN 標準のカバーブロックと完全に同じ動作をし、追加のスタイルやマークアップを一切出力しない SHALL
2. WHEN プラグインを無効化した時 THEN 既存のカバーブロックに影響を与えない SHALL
3. WHEN WordPress 6.5以上で動作する時 THEN ブロックテーマとクラシックテーマの両方で正常に機能する SHALL
4. WHEN 既存のカバーブロック属性（url、id、focalPointなど）が存在する時 THEN それらの属性は変更されない SHALL

### 要件4

**ユーザーストーリー:** WordPressサイト管理者として、プラグインの管理とメンテナンスを簡単に行いたいので、軽量で標準的な開発手法に従ったプラグインが欲しい

#### 受け入れ基準

1. WHEN プラグインをインストールした時 THEN GPL-2.0-or-later ライセンスの下で提供される SHALL
2. WHEN プラグインを使用した時 THEN 追加のマークアップを生成せず、既存の<img>要素を再利用する SHALL
3. WHEN プラグインが動作した時 THEN レイアウトシフト（CLS）が0.1以下に抑えられる SHALL
4. WHEN モバイルデバイスでアクセスした時 THEN LCP（Largest Contentful Paint）が2.5秒未満である SHALL

### 要件5

**ユーザーストーリー:** 開発者として、WordPressの標準的な開発手法に従ったコードを維持したいので、適切なコーディング規約とツールチェーンを使用したプラグインが欲しい

#### 受け入れ基準

1. WHEN JavaScriptコードを記述する時 THEN @wordpress/eslint-plugin/recommendedの規約に従う SHALL
2. WHEN PHPコードを記述する時 THEN PHPCS WordPress-Coreの規約に従う SHALL
3. WHEN ビルドプロセスを実行する時 THEN @wordpress/scriptsを使用してESNext→ES5変換が行われる SHALL
4. WHEN 開発環境をセットアップする時 THEN wp-envを使用してローカル環境でテストできる SHALL
5. WHEN テストを実行する時 THEN 詳細は要件7「テスト戦略の受け入れ基準1〜3」を参照 SHALL

### 要件6

**ユーザーストーリー:** WordPressサイト管理者として、直感的にフォーカルポイントを設定したいので、使いやすいUI/UXを提供するインターフェースが欲しい

#### 受け入れ基準

1. WHEN モバイル用フォーカルポイントを設定する時 THEN 「モバイル（600px以下）」のラベルと共にビジュアルなフォーカルポイントピッカーを使用できる SHALL
2. WHEN タブレット用フォーカルポイントを設定する時 THEN 「タブレット（601px-782px）」のラベルと共にビジュアルなフォーカルポイントピッカーを使用できる SHALL
3. WHEN 各デバイス用設定を無効にする時 THEN トグルコントロールで簡単にオン/オフできる SHALL
4. WHEN 設定を保存した時 THEN data-fp-id属性とインラインCSS変数が適切に出力される SHALL

### 要件7

**ユーザーストーリー:** 開発者として、効率的で信頼性の高いテスト戦略を実行したいので、WordPressカスタムブロックに適したテスト手法を採用したプラグインが欲しい

#### 受け入れ基準

1. WHEN 単体テストを実行する時 THEN WordPress APIに依存しない純粋な関数のテストが全体の50%を占める SHALL
2. WHEN 統合テストを実行する時 THEN save関数と属性解析のテストが全体の30%を占める SHALL
3. WHEN E2Eテストを実行する時 THEN クリティカルパスのみのテストが全体の20%を占める SHALL
4. WHEN E2Eテストを実行する時 THEN 実行時間が5分以内で完了する SHALL
5. WHEN テストカバレッジを測定する時 THEN 全体で80%以上のカバレッジを達成する SHALL
6. WHEN 偽陽性率を測定する時 THEN 5%以下に抑えられる SHALL
