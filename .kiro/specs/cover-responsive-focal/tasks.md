# 実装計画

- [x] 1. プロジェクト構造とコア型定義の設定

  - プラグインディレクトリ構造を作成（src/, build/, tests/）
  - TypeScript 型定義ファイル（types.ts）を作成
  - 定数定義ファイル（constants.ts）を作成
  - _要件: 1.1, 2.1_

- [ ] 2. バリデーション関数の実装（TDD）

  - [x] 2.1 フォーカルポイント検証関数を TDD で実装

    - validateFocalPoint 関数のテストを先に作成
    - テストを通す最小限の実装を作成
    - _要件: 1.2, 3.1_

  - [x] 2.2 メディアクエリ検証関数を TDD で実装

    - validateMediaType 関数のテストを先に作成
    - validateBreakpoint 関数のテストを先に作成
    - テストを通す実装を作成
    - _要件: 1.3, 2.2_

  - [ ] 2.3 ResponsiveFocalPoint 作成関数を TDD で実装
    - createResponsiveFocalPoint 関数のテストを先に作成
    - generateMediaQuery 関数のテストを先に作成
    - テストを通す実装を作成
    - _要件: 1.1, 1.2, 1.3_

- [ ] 3. ブロック拡張システムの実装

  - [ ] 3.1 カバーブロック属性拡張の実装

    - blocks.registerBlockType フィルターを実装
    - responsiveFocal 属性と dataFpId 属性を追加
    - 既存カバーブロック属性との統合テストを作成
    - _要件: 1.1, 2.1_

  - [ ] 3.2 ブロック保存機能の拡張
    - save 関数の拡張を実装
    - data-fp-id 属性をマークアップに追加
    - 空の responsiveFocal 配列の場合の標準動作を維持
    - _要件: 2.3, 3.2_

- [ ] 4. インスペクターコントロール UI の実装

  - [ ] 4.1 基本 UI コンポーネントの作成

    - ResponsiveFocalControls コンポーネントを作成
    - PanelBody と Button 要素の基本構造を実装
    - 「新しいブレークポイントを追加」機能を実装
    - _要件: 1.4, 2.4_

  - [ ] 4.2 フォーカルポイント設定 UI の実装

    - SelectControl（メディアクエリタイプ選択）を実装
    - NumberControl（ブレークポイント入力）を実装
    - プリセットブレークポイント選択機能を実装
    - FocalPointPicker コンポーネントを統合
    - _要件: 1.2, 1.3, 1.4_

  - [ ] 4.3 行管理機能の実装
    - 行削除機能を実装
    - ドラッグ&ドロップ並び替え機能を実装
    - 複数行の状態管理を実装
    - _要件: 1.5, 2.4_

- [ ] 5. サーバーサイド CSS 生成の実装（TDD）

  - [ ] 5.1 CSS 生成関数を TDD で実装

    - crf_generate_css_rules 関数のテストを先に作成
    - 単一フォーカルポイントの CSS 生成を実装
    - 複数フォーカルポイントの CSS 生成を実装
    - _要件: 2.2, 2.3, 3.1_

  - [ ] 5.2 サニタイゼーション関数を TDD で実装

    - crf_sanitize_focal_point 関数のテストを先に作成
    - XSS 攻撃防止のサニタイゼーションを実装
    - CSS Injection 防止の処理を実装
    - _要件: 3.1, 3.3_

  - [ ] 5.3 render_block フィルターの実装
    - crf_render_block 関数を実装
    - data-fp-id 属性をコンテンツに追加する処理を実装
    - インラインスタイルタグの生成と挿入を実装
    - _要件: 2.3, 3.2_

- [ ] 6. プラグインメインファイルの実装

  - [ ] 6.1 PHP プラグインファイルの作成

    - cover-responsive-focal.php ファイルを作成
    - プラグインヘッダー情報を記述
    - 必要なフィルターフックを登録
    - _要件: 2.1, 2.3_

  - [ ] 6.2 アセット読み込み処理の実装
    - wp_enqueue_script で JavaScript ファイルを読み込み
    - wp_enqueue_style で CSS ファイルを読み込み
    - 依存関係（wp-blocks, wp-element 等）を設定
    - _要件: 2.1, 2.4_

- [ ] 7. ビルドシステムの設定

  - [ ] 7.1 webpack 設定の作成

    - TypeScript 用の webpack.config.js を作成
    - エントリーポイント（src/index.tsx）を設定
    - 出力先（build/）を設定
    - _要件: 2.1_

  - [ ] 7.2 package.json 設定
    - 必要な依存関係を追加（@wordpress/blocks 等）
    - ビルドスクリプトを設定
    - 開発用スクリプトを設定
    - _要件: 2.1_

- [ ] 8. テスト環境の基盤設定

  - [ ] 8.1 JavaScript/TypeScript テスト環境設定

    - Jest 設定ファイルを作成
    - テストユーティリティとモックの設定
    - カバレッジレポート設定
    - _要件: 3.4_

  - [ ] 8.2 PHP テスト環境設定
    - PHPUnit 設定ファイルを作成
    - WordPress Test Suite 環境設定
    - テストデータベース設定
    - _要件: 3.4_

- [ ] 9. E2E テスト環境の設定

  - [ ] 9.1 Playwright 環境設定

    - Playwright 設定ファイルを作成
    - WordPress 環境のセットアップ
    - テスト用データの準備
    - _要件: 3.4_

  - [ ] 9.2 E2E テストの実装
    - ブロックエディタでの操作テストを実装
    - レスポンシブフォーカルポイント設定の E2E テストを実装
    - フロントエンド表示確認の E2E テストを実装
    - ビジュアル回帰テストを実装
    - _要件: 3.4_

- [ ] 10. パフォーマンス最適化

  - [ ] 10.1 CSS 生成の最適化

    - CSS 出力の最小化処理を実装
    - 重複メディアクエリの統合処理を実装
    - キャッシュ機能の実装
    - _要件: 3.5_

  - [ ] 10.2 フロントエンドパフォーマンス最適化
    - レイアウトシフト最小化の実装
    - 遅延読み込み対応の実装
    - _要件: 3.5_

- [ ] 11. 国際化対応の実装

  - [ ] 11.1 翻訳ファイルの作成

    - POT ファイル生成設定を作成
    - 日本語翻訳ファイル（ja.po）を作成
    - 英語翻訳ファイル（en_US.po）を作成
    - _要件: 2.5_

  - [ ] 11.2 翻訳関数の実装
    - \_\_()関数を使用した文字列の翻訳対応
    - JavaScript 側の翻訳対応（wp.i18n）
    - _要件: 2.5_

- [ ] 12. CI/CD 環境の設定

  - [ ] 12.1 GitHub Actions 設定

    - 自動テスト実行ワークフローを作成
    - 複数 PHP/WordPress バージョンでのテストマトリックスを設定
    - コードカバレッジレポート生成を設定
    - _要件: 3.4_

  - [ ] 12.2 品質チェック設定
    - ESLint 設定を作成
    - PHP_CodeSniffer 設定を作成
    - 自動コード整形設定を作成
    - _要件: 3.4_

- [ ] 13. ドキュメントとリリース準備

  - [ ] 13.1 README.md ファイルの作成

    - インストール手順を記述
    - 使用方法を記述
    - 開発者向け情報を記述
    - _要件: 2.6_

  - [ ] 13.2 WordPress.org 用 readme.txt の作成
    - プラグイン説明を記述
    - インストール手順を記述
    - FAQ・サポート情報を記述
    - _要件: 2.6_

- [ ] 14. 最終統合テストと動作確認

  - [ ] 14.1 全機能統合テスト

    - 全ての実装機能の統合動作テストを実行
    - 既存カバーブロックとの互換性を最終確認
    - 複数ブラウザでの動作確認を実行
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 3.1, 3.2, 3.3, 3.4, 3.5_

  - [ ] 14.2 リリース前最終チェック
    - 全テストスイートの実行と結果確認
    - パフォーマンス指標の最終確認
    - セキュリティチェックの最終確認
    - _要件: 3.3, 3.4, 3.5_
